version: '3.8'

services:
  caddy:
    # Use pre-built image from GHCR or build locally
    # image: ghcr.io/YOUR_USERNAME/caddy-redirect:latest
    build: .
    ports:
      - "80:80"
      - "443:443"
    environment:
      # Haupt-Domain (erforderlich)
      - CADDY_DOMAIN=${CADDY_DOMAIN:-localhost}

      # E-Mail für automatische HTTPS-Zertifikate
      - CADDY_EMAIL=${CADDY_EMAIL:-}

      # Upstream-Server (wo Anfragen weitergeleitet werden)
      - CADDY_UPSTREAM=${CADDY_UPSTREAM:-http://localhost:8080}

      # Zusätzliche Header
      - CADDY_HEADERS=${CADDY_HEADERS:-}

      # Rate Limiting (z.B.: "rate_limit { zone static { key {remote} window 1m burst 10 } }")
      - CADDY_RATE_LIMIT=${CADDY_RATE_LIMIT:-}

      # Basic Auth (z.B.: "basicauth { user $2a$14$... }")
      - CADDY_BASIC_AUTH=${CADDY_BASIC_AUTH:-}

      # Redirects (z.B.: "redir /old /new permanent")
      - CADDY_REDIRECTS=${CADDY_REDIRECTS:-}

      # Zusätzliche Proxy-Header
      - CADDY_PROXY_HEADERS=${CADDY_PROXY_HEADERS:-}

      # Zusätzliche Domains (durch Komma getrennt)
      - CADDY_ADDITIONAL_DOMAINS=${CADDY_ADDITIONAL_DOMAINS:-}
    volumes:
      # Für automatische HTTPS-Zertifikate
      - caddy_data:/data
      - caddy_config:/config
    restart: unless-stopped

volumes:
  caddy_data:
  caddy_config:
